# ðŸ¥ RenoveJÃ¡ - Arquitetura e Fluxos

## ðŸ“ VisÃ£o Geral

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND (Expo)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Paciente â”‚  â”‚  MÃ©dico  â”‚  â”‚Enfermeiroâ”‚  â”‚  Admin   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTP/REST
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND (FastAPI)                            â”‚
â”‚                    http://localhost:8001                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      /api/*                              â”‚   â”‚
â”‚  â”‚  â€¢ /auth/*     - AutenticaÃ§Ã£o                           â”‚   â”‚
â”‚  â”‚  â€¢ /requests/* - SolicitaÃ§Ãµes                           â”‚   â”‚
â”‚  â”‚  â€¢ /doctors/*  - Fila mÃ©dica                            â”‚   â”‚
â”‚  â”‚  â€¢ /nursing/*  - Fila enfermagem                        â”‚   â”‚
â”‚  â”‚  â€¢ /payments/* - Pagamentos                             â”‚   â”‚
â”‚  â”‚  â€¢ /chat/*     - Mensagens                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ REST API
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE (PostgreSQL)                        â”‚
â”‚              gklkznyyouwqsohszula.supabase.co                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  users  â”‚ â”‚requests â”‚ â”‚payments â”‚ â”‚  chat   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ” 1. FLUXO DE AUTENTICAÃ‡ÃƒO

### 1.1 Registro de Paciente
```
Frontend                          Backend                         Supabase
   â”‚                                 â”‚                                â”‚
   â”‚ POST /auth/register             â”‚                                â”‚
   â”‚ {name, email, password}         â”‚                                â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                                â”‚
   â”‚                                 â”‚ INSERT users                   â”‚
   â”‚                                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                 â”‚                                â”‚
   â”‚                                 â”‚ INSERT active_tokens           â”‚
   â”‚                                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                 â”‚                                â”‚
   â”‚ {access_token, user}            â”‚                                â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                â”‚
   â”‚                                 â”‚                                â”‚
   â”‚ AsyncStorage.setItem('token')   â”‚                                â”‚
   â”‚ AsyncStorage.setItem('user')    â”‚                                â”‚
```

### 1.2 Login
```
Frontend                          Backend                         Supabase
   â”‚                                 â”‚                                â”‚
   â”‚ POST /auth/login                â”‚                                â”‚
   â”‚ {email, password}               â”‚                                â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                                â”‚
   â”‚                                 â”‚ SELECT users WHERE email       â”‚
   â”‚                                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                 â”‚                                â”‚
   â”‚                                 â”‚ Verifica password_hash         â”‚
   â”‚                                 â”‚                                â”‚
   â”‚                                 â”‚ SELECT doctor_profiles         â”‚
   â”‚                                 â”‚ (se role = doctor)             â”‚
   â”‚                                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                 â”‚                                â”‚
   â”‚ {access_token, user, profile}   â”‚                                â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                â”‚
   â”‚                                 â”‚                                â”‚
   â”‚ Redireciona por role:           â”‚                                â”‚
   â”‚ â€¢ patient â†’ /(tabs)             â”‚                                â”‚
   â”‚ â€¢ doctor  â†’ /doctor             â”‚                                â”‚
   â”‚ â€¢ nurse   â†’ /nurse              â”‚                                â”‚
   â”‚ â€¢ admin   â†’ /admin              â”‚                                â”‚
```

---

## ðŸ“‹ 2. FLUXO DE SOLICITAÃ‡ÃƒO DE RECEITA (Paciente)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PACIENTE                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. Seleciona tipo de receita
         â”‚    /prescription â†’ Escolhe: Simples, Controlada, Azul
         â–¼
         â”‚ 2. Faz upload da receita anterior
         â”‚    /prescription/upload â†’ Tira foto ou seleciona da galeria
         â–¼
         â”‚ 3. Confirma e paga
         â”‚    /prescription/payment
         â”‚
         â”‚ POST /requests/prescription
         â”‚ {prescription_type, prescription_images, notes}
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND                                                         â”‚
â”‚                                                                 â”‚
â”‚ â€¢ Cria request com status = "submitted"                        â”‚
â”‚ â€¢ Calcula preÃ§o baseado no tipo                                â”‚
â”‚ â€¢ Cria notificaÃ§Ã£o para paciente                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Request entra na fila de mÃ©dicos
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MÃ‰DICO vÃª na fila (GET /doctors/queue)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ‘¨â€âš•ï¸ 3. FLUXO DO MÃ‰DICO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DASHBOARD DO MÃ‰DICO (/doctor)                                   â”‚
â”‚                                                                 â”‚
â”‚ GET /doctors/queue retorna:                                     â”‚
â”‚ {                                                               â”‚
â”‚   pending: [],              â† SolicitaÃ§Ãµes aguardando           â”‚
â”‚   analyzing: [],            â† Em anÃ¡lise por este mÃ©dico        â”‚
â”‚   forwarded_from_nursing: [],â† Exames da enfermagem             â”‚
â”‚   awaiting_payment: [],     â† Aprovadas, aguardando pagamento   â”‚
â”‚   awaiting_signature: []    â† Pagas, aguardando assinatura      â”‚
â”‚ }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FLUXO DE ATENDIMENTO:

1. ACEITAR SOLICITAÃ‡ÃƒO
   POST /requests/{id}/accept
   â€¢ status: submitted â†’ in_review
   â€¢ doctor_id = mÃ©dico logado
   â€¢ Notifica paciente

2. ANALISAR (ver detalhes, fotos, chat)
   GET /requests/{id}
   /doctor/request/[id]

3. DECISÃƒO:
   
   âœ… APROVAR                          âŒ RECUSAR
   POST /requests/{id}/approve         POST /requests/{id}/reject
   {price: 49.90}                      {reason: "Receita ilegÃ­vel"}
   â€¢ status â†’ approved_pending_payment  â€¢ status â†’ rejected
   â€¢ Notifica paciente para pagar       â€¢ Notifica paciente
   
4. APÃ“S PAGAMENTO (status = paid):
   POST /requests/{id}/sign
   â€¢ Gera assinatura digital
   â€¢ status â†’ signed
   â€¢ Paciente pode baixar receita
```

---

## ðŸ¥ 4. FLUXO DA ENFERMAGEM (Exames)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Paciente solicita EXAME                                         â”‚
â”‚ POST /requests/exam                                             â”‚
â”‚ {description, exam_images}                                      â”‚
â”‚                                                                 â”‚
â”‚ status = "submitted" (vai para fila da ENFERMAGEM, nÃ£o mÃ©dico) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DASHBOARD ENFERMAGEM (/nurse)                                   â”‚
â”‚ GET /nursing/queue                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ POST /nursing/accept/{id}
         â”‚ status â†’ in_nursing_review
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TRIAGEM - Enfermeiro analisa                                    â”‚
â”‚                                                                 â”‚
â”‚ OPÃ‡Ã•ES:                                                         â”‚
â”‚                                                                 â”‚
â”‚ 1. âœ… APROVAR (exame simples, dentro do protocolo)             â”‚
â”‚    POST /nursing/approve/{id}                                   â”‚
â”‚    {price, exam_type, exams}                                    â”‚
â”‚    status â†’ approved_by_nursing_pending_payment                 â”‚
â”‚                                                                 â”‚
â”‚ 2. ðŸ”„ ENCAMINHAR PARA MÃ‰DICO (fora do protocolo)               â”‚
â”‚    POST /nursing/forward-to-doctor/{id}                         â”‚
â”‚    status â†’ in_medical_review                                   â”‚
â”‚    (aparece em forwarded_from_nursing do mÃ©dico)                â”‚
â”‚                                                                 â”‚
â”‚ 3. âŒ RECUSAR                                                   â”‚
â”‚    POST /nursing/reject/{id}                                    â”‚
â”‚    {reason}                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ’° 5. FLUXO DE PAGAMENTO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SolicitaÃ§Ã£o aprovada (status = approved_pending_payment)        â”‚
â”‚                                                                 â”‚
â”‚ Paciente acessa /request/[id] ou recebe notificaÃ§Ã£o            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ POST /payments
         â”‚ {request_id, amount, method: "pix"}
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend gera:                                                   â”‚
â”‚ â€¢ pix_code (cÃ³digo copia-cola)                                 â”‚
â”‚ â€¢ qr_code_base64 (QR code)                                     â”‚
â”‚                                                                 â”‚
â”‚ Retorna payment_id                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Paciente paga (copia cÃ³digo ou escaneia QR)
         â”‚
         â”‚ POST /payments/{id}/confirm (ou webhook do MercadoPago)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ payment.status â†’ completed                                    â”‚
â”‚ â€¢ request.status â†’ paid                                         â”‚
â”‚ â€¢ Notifica MÃ‰DICO: "Paciente pagou, assine a receita"          â”‚
â”‚ â€¢ Notifica PACIENTE: "Pagamento confirmado"                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ’¬ 6. FLUXO DE CHAT

```
PACIENTE                                    MÃ‰DICO
    â”‚                                          â”‚
    â”‚ Abre /chat/[requestId]                   â”‚ Abre /doctor/chat/[id]
    â”‚                                          â”‚
    â”‚ GET /chat/{requestId}                    â”‚ GET /chat/{requestId}
    â”‚ (carrega mensagens)                      â”‚ (carrega mensagens)
    â”‚                                          â”‚
    â”‚ POST /chat                               â”‚
    â”‚ {request_id, message}  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                                          â”‚
    â”‚                        <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ POST /chat
    â”‚                                          â”‚ {request_id, message}
    â”‚                                          â”‚
    â”‚ Polling a cada 3-10s                     â”‚ Polling a cada 3-10s
    â”‚ (adaptativo)                             â”‚ (adaptativo)
```

---

## ðŸ”” 7. FLUXO DE NOTIFICAÃ‡Ã•ES

```
EVENTOS QUE GERAM NOTIFICAÃ‡ÃƒO:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PARA O PACIENTE:                                                â”‚
â”‚                                                                 â”‚
â”‚ â€¢ SolicitaÃ§Ã£o criada         â†’ "âœ… SolicitaÃ§Ã£o Criada"         â”‚
â”‚ â€¢ MÃ©dico aceitou             â†’ "SolicitaÃ§Ã£o em anÃ¡lise"        â”‚
â”‚ â€¢ Aprovada                   â†’ "âœ… Aprovada! Pague para..."    â”‚
â”‚ â€¢ Recusada                   â†’ "âŒ Recusada. Motivo: ..."      â”‚
â”‚ â€¢ Receita assinada           â†’ "ðŸ“ Receita pronta!"            â”‚
â”‚ â€¢ Nova mensagem no chat      â†’ "ðŸ’¬ Nova mensagem de Dr..."     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PARA O MÃ‰DICO:                                                  â”‚
â”‚                                                                 â”‚
â”‚ â€¢ Nova solicitaÃ§Ã£o atribuÃ­da â†’ "ðŸ“‹ Nova solicitaÃ§Ã£o de..."     â”‚
â”‚ â€¢ Pagamento recebido         â†’ "ðŸ’° Paciente pagou. Assine."    â”‚
â”‚ â€¢ Nova mensagem no chat      â†’ "ðŸ’¬ Nova mensagem de..."        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Frontend busca: GET /notifications
Marca como lida: PUT /notifications/{id}/read
```

---

## ðŸ“Š 8. ESTADOS DA SOLICITAÃ‡ÃƒO (status)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  submitted  â”‚ â† Criada pelo paciente
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                               â”‚
           â–¼                               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  in_review  â”‚                â”‚in_nursing_reviewâ”‚ (sÃ³ exames)
    â”‚  (mÃ©dico)   â”‚                â”‚  (enfermagem)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                â”‚
     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚           â”‚              â”‚          â”‚          â”‚
     â–¼           â–¼              â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚rejectedâ”‚ â”‚approved_ â”‚  â”‚approved_ â”‚ â”‚rejectedâ”‚ â”‚in_medicalâ”‚
â”‚        â”‚ â”‚pending_  â”‚  â”‚by_nursingâ”‚ â”‚        â”‚ â”‚_review   â”‚
â”‚        â”‚ â”‚payment   â”‚  â”‚_pending_ â”‚ â”‚        â”‚ â”‚(â†’mÃ©dico) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚payment   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                â”‚             â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚   paid   â”‚ â† Paciente pagou
                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  signed  â”‚ â† MÃ©dico assinou
                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚delivered â”‚ â† Entregue ao paciente
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”— 9. MAPEAMENTO ENDPOINTS â†” TELAS

| Tela Frontend | Endpoints Backend |
|---------------|-------------------|
| `/login` | POST `/auth/login` |
| `/register` | POST `/auth/register` |
| `/doctor-register` | POST `/auth/register-doctor` |
| `/register-nurse` | POST `/auth/register-nurse` |
| `/(tabs)` | GET `/requests`, GET `/notifications` |
| `/prescription/*` | POST `/requests/prescription`, POST `/payments` |
| `/exam/*` | POST `/requests/exam` |
| `/consultation/*` | POST `/requests/consultation` |
| `/request/[id]` | GET `/requests/{id}`, POST `/payments` |
| `/doctor` | GET `/doctors/queue` |
| `/doctor/request/[id]` | GET `/requests/{id}`, POST `/requests/{id}/accept|approve|reject|sign` |
| `/doctor/chat/[id]` | GET `/chat/{id}`, POST `/chat` |
| `/nurse` | GET `/nursing/queue` |
| `/nurse/request/[id]` | POST `/nursing/accept|approve|forward|reject` |
| `/admin` | GET `/admin/stats` |

---

## âœ… 10. CHECKLIST DE INTEGRAÃ‡ÃƒO

- [x] AutenticaÃ§Ã£o com token
- [x] Registro paciente/mÃ©dico/enfermeiro
- [x] CriaÃ§Ã£o de solicitaÃ§Ãµes
- [x] Fila de mÃ©dicos
- [x] Fila de enfermagem
- [x] Fluxo de aprovaÃ§Ã£o/rejeiÃ§Ã£o
- [x] Sistema de pagamento (simulado)
- [x] Assinatura digital
- [x] Chat mÃ©dico-paciente
- [x] NotificaÃ§Ãµes
- [x] Dashboard admin
- [ ] Push notifications (Expo) - configurar
- [ ] Pagamento real (MercadoPago) - configurar
- [ ] Video chamada (Jitsi) - funcional

---

## ðŸš€ PRÃ“XIMOS PASSOS

1. **Testar fluxo completo** localmente
2. **Configurar MercadoPago** para pagamentos reais
3. **Deploy** backend (Railway/Render)
4. **Build** do app (EAS Build)
5. **Publicar** na Play Store / App Store
